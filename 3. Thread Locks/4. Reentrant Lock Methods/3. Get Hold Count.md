

---

# ReentrantLock – `getHoldCount()` Method (Java Multithreading)

## 1. What is `ReentrantLock`?

`ReentrantLock` is a class present in
`java.util.concurrent.locks` package.

It allows:

* Explicit lock/unlock control
* Reentrancy (same thread can acquire the same lock multiple times)
* Advanced locking features compared to `synchronized`

---

## 2. What is Reentrancy?

**Reentrancy** means:

> A thread that already holds a lock can acquire the same lock again **without blocking**.

Each successful call to `lock()` by the **same thread** increases the **hold count** by `1`.

---

## 3. `getHoldCount()` Method

### Method Signature

```java
public int getHoldCount()
```

### Definition

Returns the **number of times the current thread has acquired the lock**.

### Key Points

* Returns hold count **only for the calling thread**
* Each `lock()` → hold count +1
* Each `unlock()` → hold count −1
* Lock is fully released **only when hold count becomes 0**

---

## 4. Example Code

### `MyThread.java`

```java
import java.util.concurrent.locks.ReentrantLock;

class MyThread extends Thread {
    ReentrantLock lock;

    public MyThread(String name, ReentrantLock lock) {
        super(name);
        this.lock = lock;
    }

    @Override
    public void run() {
        System.out.println(getName() + " is trying to acquire the lock");

        lock.lock();   // hold count = 1
        lock.lock();   // hold count = 2

        System.out.println(getName() + " has acquired the lock");

        for (int i = 0; i < 5; i++) {
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            System.out.println(getName() + " : " + i);
        }

        System.out.println(getName() + " is holding " + lock.getHoldCount() + " locks");

        lock.unlock(); // hold count = 1
        System.out.println(getName() + " is holding " + lock.getHoldCount() + " locks");

        lock.unlock(); // hold count = 0
        System.out.println(getName() + " is holding " + lock.getHoldCount() + " locks");

        System.out.println(getName() + " has released the lock");
    }
}
```

---

### `Main.java`

```java
import java.util.concurrent.locks.ReentrantLock;

public class Main {
    public static void main(String[] args) {
        ReentrantLock lock = new ReentrantLock();

        MyThread thread1 = new MyThread("Thread 1", lock);
        MyThread thread2 = new MyThread("Thread 2", lock);

        thread1.start();
        thread2.start();
    }
}
```

---

## 5. Sample Output (One Possible Execution)

```
Thread 1 is trying to acquire the lock
Thread 2 is trying to acquire the lock
Thread 1 has acquired the lock
Thread 1 : 0
Thread 1 : 1
Thread 1 : 2
Thread 1 : 3
Thread 1 : 4
Thread 1 is holding 2 locks
Thread 1 is holding 1 locks
Thread 2 has acquired the lock
Thread 1 is holding 0 locks
Thread 1 has released the lock
Thread 2 : 0
Thread 2 : 1
Thread 2 : 2
Thread 2 : 3
Thread 2 : 4
Thread 2 is holding 2 locks
Thread 2 is holding 1 locks
Thread 2 is holding 0 locks
Thread 2 has released the lock
```

> ⚠️ Output order may vary depending on thread scheduling.

---

## 6. Step-by-Step Execution Explanation

### Assume Thread 1 gets the lock first:

1. **Thread 1 calls `lock()` twice**

   * Hold count becomes `2`
2. **Thread 2 is blocked** (cannot acquire lock)
3. Thread 1 completes loop execution
4. `getHoldCount()` → returns `2`
5. First `unlock()` → hold count becomes `1`
6. Second `unlock()` → hold count becomes `0`
7. Lock is fully released
8. Thread 2 now acquires the lock and repeats same steps

---

## 7. Important Interview Points ⭐

* `getHoldCount()` returns **hold count of current thread only**
* Lock is released **only when unlock() is called same number of times as lock()**
* Calling `unlock()` fewer times → lock is **not released**
* Extra `unlock()` → `IllegalMonitorStateException`

---

## 8. One-Line Summary

> `getHoldCount()` tells how many times the **current thread** has acquired a `ReentrantLock`, helping track reentrant locking behavior.

---
