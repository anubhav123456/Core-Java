---

# âœ… **Deadlock in Java**

---

### What is Deadlock?

Deadlock is a situation in which **two or more threads wait indefinitely for each other to release locks**. Each thread holds at least one lock and waits for another lock held by a different thread.

> Because none of the threads can proceed, the program **hangs forever**.

---

## Bank Deposit Deadlock Example

### Scenario

* **Student Account** and **University Account**
* **Thread-1**: Student pays semester fee â†’ Student âž University ($3000)
* **Thread-2**: University refunds money â†’ University âž Student ($1000)
* Both transfers happen **at the same time**

---

## Step-by-Step Deadlock Flow

1. Thread-1 locks **Student Account**
2. Thread-2 locks **University Account**
3. Thread-1 waits for **University Account**
4. Thread-2 waits for **Student Account**
5. Thread-1 waits for Thread-2
6. Thread-2 waits for Thread-1
7. âŒ **Deadlock occurs** (infinite waiting)

---

## Account Class

```java
class Account {
    private final String name;
    private int balance;

    public Account(String name, int balance) {
        this.name = name;
        this.balance = balance;
    }

    public void deposit(int amount) {
        balance += amount;
    }

    public void withdraw(int amount) {
        balance -= amount;
    }

    public String getName() {
        return name;
    }
}
```

---

## BankTransfer Class (Deadlock Happens Here)

```java
class BankTransfer {

    // Student -> University
    public static void payFee(Account student, Account university, int amount) {
        synchronized (student) {
            System.out.println(Thread.currentThread().getName() + " locked " + student.getName());

            try { Thread.sleep(100); } catch (InterruptedException e) {}

            synchronized (university) {
                System.out.println(Thread.currentThread().getName() + " locked " + university.getName());
                student.withdraw(amount);
                university.deposit(amount);
            }
        }
    }

    // University -> Student
    public static void refund(Account university, Account student, int amount) {
        synchronized (university) {
            System.out.println(Thread.currentThread().getName() + " locked " + university.getName());

            try { Thread.sleep(100); } catch (InterruptedException e) {}

            synchronized (student) {
                System.out.println(Thread.currentThread().getName() + " locked " + student.getName());
                university.withdraw(amount);
                student.deposit(amount);
            }
        }
    }
}
```

---

## Main Class

```java
public class Main {
    public static void main(String[] args) {
        Account student = new Account("Student Account", 5000);
        Account university = new Account("University Account", 10000);

        Thread t1 = new Thread(() -> {
            BankTransfer.payFee(student, university, 3000);
        }, "Thread-1");

        Thread t2 = new Thread(() -> {
            BankTransfer.refund(university, student, 1000);
        }, "Thread-2");

        t1.start();
        t2.start();
    }
}
```

---

## Output (Program Hangs)

```text
Thread-1 locked Student Account
Thread-2 locked University Account
```

âŒ Program never terminates â†’ **Deadlock confirmed**

---

## Why Deadlock Occurs â€“ 4 Necessary Conditions

1ï¸âƒ£ **Mutual Exclusion**
Only one thread can hold a lock on an account at a time

2ï¸âƒ£ **Hold and Wait**
Each thread holds one lock and waits for another

3ï¸âƒ£ **No Preemption**
Locks cannot be taken forcefully from a thread

4ï¸âƒ£ **Circular Wait**

* Thread-1 â†’ Student â†’ University
* Thread-2 â†’ University â†’ Student

âœ… All 4 conditions satisfied â‡’ **Deadlock occurs**

---

## Interview Tip ðŸ§ 

> Deadlock happens when multiple threads acquire locks in **different order**.

---

