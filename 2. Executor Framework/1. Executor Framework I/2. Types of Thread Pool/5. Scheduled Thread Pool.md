
---

# Scheduled Thread Pool in Java (ScheduledExecutorService)

## 1. What is ScheduledExecutorService?

`ScheduledExecutorService` is a sub-interface of `ExecutorService` used to **schedule tasks to run after a delay or periodically**.

It is commonly used for:

* Polling systems (health checks, endpoint probing)
* Background cleanup tasks
* Periodic monitoring jobs
* Replacing `Timer` and `TimerTask` (thread-safe alternative)

---

## 2. Creating a Scheduled Thread Pool

We create a scheduled thread pool using the `Executors` factory class.

```java
ScheduledExecutorService service =
        Executors.newScheduledThreadPool(1);
```

* `1` → number of threads in the pool
* Tasks are executed by these threads based on schedule

---

## 3. Example: Scheduled Executor Demo

### Task: `ProbeTask`

* Implements `Runnable`
* Prints a message every time it runs

```java
class ProbeTask implements Runnable {
    @Override
    public void run() {
        System.out.println("Probing endpoint for updates....");
    }
}
```

---

### Main Class: `ScheduledExecutorDemo`

```java
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

public class ScheduledExecutorDemo {

    public static void main(String[] args) {

        // Create a scheduled thread pool with one thread
        ScheduledExecutorService service =
                Executors.newScheduledThreadPool(1);

        // Schedule task:
        // initial delay = 1000 ms
        // period = 2000 ms
        service.scheduleAtFixedRate(
                new ProbeTask(),
                1000,
                2000,
                TimeUnit.MILLISECONDS
        );

        try {
            // Wait for 10 seconds
            if (!service.awaitTermination(10000, TimeUnit.MILLISECONDS)) {
                service.shutdownNow();
            }
        } catch (InterruptedException e) {
            service.shutdownNow();
        }
    }
}
```

---

## 4. Understanding `scheduleAtFixedRate()`

```java
service.scheduleAtFixedRate(
    Runnable command,
    long initialDelay,
    long period,
    TimeUnit unit
);
```

### Parameters:

| Parameter    | Meaning                            |
| ------------ | ---------------------------------- |
| Runnable     | Task to execute                    |
| initialDelay | Delay before first execution       |
| period       | Time between successive executions |
| TimeUnit     | Unit of delay and period           |

### Behavior:

* Task starts **after initial delay**
* Executes **at a fixed rate**, regardless of execution time (if possible)

---

## 5. Sample Output

```
Probing endpoint for updates....
Probing endpoint for updates....
Probing endpoint for updates....
Probing endpoint for updates....
Probing endpoint for updates....
```

### Explanation:

* First message printed after **1 second**
* Printed every **2 seconds**
* Stops automatically after **10 seconds**

---

## 6. Stopping the Scheduled Executor

### `awaitTermination()`

* Waits for executor termination for a given time
* Returns `false` if not terminated within time

```java
service.awaitTermination(10000, TimeUnit.MILLISECONDS);
```

---

## 7. `shutdown()` vs `shutdownNow()`

### `shutdown()`

* Graceful shutdown
* Previously submitted tasks are executed
* No new tasks accepted

```java
service.shutdown();
```

### `shutdownNow()`

* Forceful shutdown
* Attempts to stop all running tasks immediately
* Interrupts threads

```java
service.shutdownNow();
```

| Method      | Running Tasks       | Queued Tasks |
| ----------- | ------------------- | ------------ |
| shutdown    | Allowed to complete | Executed     |
| shutdownNow | Interrupted         | Discarded    |

---

## 8. Other Scheduling Methods

### `schedule()`

Executes task **once after a delay**

```java
service.schedule(task, 3, TimeUnit.SECONDS);
```

---

### `scheduleAtFixedRate()`

* Executes periodically
* Fixed time between start of executions

```java
service.scheduleAtFixedRate(task, 1, 2, TimeUnit.SECONDS);
```

---

### `scheduleWithFixedDelay()`

* Delay **after task completes**
* Useful when execution time varies

```java
service.scheduleWithFixedDelay(task, 1, 2, TimeUnit.SECONDS);
```

| Method      | Delay Type            |
| ----------- | --------------------- |
| Fixed Rate  | Between start times   |
| Fixed Delay | After task completion |

---

## 9. Internal Working of ScheduledExecutorService

### Uses a **DelayQueue**

* Tasks are ordered by **execution time**
* Similar to a **priority queue**
* Earliest execution time gets highest priority

### Example:

| Task   | Scheduled After |
| ------ | --------------- |
| Task A | 10 seconds      |
| Task B | 15 seconds      |

➡ Task A executes first

---

## 10. Key Takeaways (Interview Ready)

* `ScheduledExecutorService` is preferred over `Timer`
* Supports delayed and periodic execution
* Uses `DelayQueue` internally
* `shutdown()` is graceful, `shutdownNow()` is forceful
* Ideal for polling, monitoring, background jobs

---

