
---

# Daemon Threads and User Threads in Java

## 1. Types of Threads (Based on Surface of Execution)

On the basis of **surface of execution**, threads in Java are of two types:

1. **User Threads**
2. **Daemon Threads**

---

## 2. Main Thread Behavior

* When a Java program starts, the **main thread** (the thread executing `main()` method) starts running immediately.
* From the main thread, we can create and start **child threads**.
* Under normal circumstances, the **main thread is the last thread to finish execution**, because it performs various JVM shutdown operations.

---

## 3. User Threads

* User threads are **foreground threads**.
* They perform the **main logic of the application**.
* The JVM **waits for all user threads to complete** before shutting down.
* By default, **every thread is a user thread** unless explicitly marked as a daemon thread.

---

## 4. Daemon Threads

* Daemon threads are **background/helper threads**.
* They usually have **low priority**.
* They perform supporting tasks such as:

  * Garbage Collection (GC)
  * Background monitoring
  * Housekeeping operations
* Example: **Garbage Collector thread**

### Important Rule:

> **Daemon threads are automatically terminated by the JVM when all user threads finish execution.**

---

## 5. Key Difference Between User and Daemon Threads

| Feature                  | User Thread | Daemon Thread                 |
| ------------------------ | ----------- | ----------------------------- |
| Runs in foreground       | âœ… Yes       | âŒ No                          |
| Runs in background       | âŒ No        | âœ… Yes                         |
| JVM waits for completion | âœ… Yes       | âŒ No                          |
| Terminated automatically | âŒ No        | âœ… Yes (when user threads end) |
| Default thread type      | âœ… Yes       | âŒ No                          |

---

## 6. How to Make a Thread a Daemon Thread

```java
thread.setDaemon(true);
```

âš ï¸ **Important:**
`setDaemon(true)` must be called **before** calling `start()`.

---

## 7. Code Example: Daemon Thread vs User Thread

### Java Code

```java
public class Main
{
    public static void main(String[] args)
    {
        Thread daemonThread = new Thread(() ->
        {
            for (int i = 0; i < 500; i++)
            {
                try
                {
                    Thread.sleep(1000);
                }
                catch (InterruptedException e)
                {
                    throw new RuntimeException(e);
                }
                System.out.println(Thread.currentThread().getName() + " is running : " + i);
            }
        }, "Daemon Thread");

        Thread userThread = new Thread(() ->
        {
            try
            {
                Thread.sleep(5000);
            }
            catch (InterruptedException e)
            {
                throw new RuntimeException(e);
            }

            System.out.println(Thread.currentThread().getName() + " is done with execution.");
        }, "User Thread");

        // Mark daemon thread
        daemonThread.setDaemon(true);

        daemonThread.start();
        userThread.start();
    }
}
```

---

## 8. Output

```
Daemon Thread is running : 0
Daemon Thread is running : 1
Daemon Thread is running : 2
Daemon Thread is running : 3
User Thread is done with execution.
```

---

## 9. Explanation of Output

1. **User Thread**

   * Sleeps for **5 seconds**
   * After waking up, prints:

     ```
     User Thread is done with execution.
     ```

2. **Daemon Thread**

   * Sleeps for **1 second** in each iteration
   * Runs in the background and prints output every second

3. While the user thread is sleeping:

   * The daemon thread gets CPU time
   * It runs approximately **4 times**

4. Once the **user thread completes execution**:

   * JVM detects that **no user threads are alive**
   * JVM shuts down
   * **Daemon thread is forcefully terminated**, even though its loop was not completed

---

## 10. Final Conclusion

* **User threads control the lifecycle of the JVM**
* **Daemon threads cannot keep the JVM alive**
* Once all user threads finish:

  * JVM shuts down
  * All daemon threads are terminated automatically

ðŸ‘‰ **This proves that user threads are given priority over daemon threads**, and daemon threads exist only to support user threads.

---
