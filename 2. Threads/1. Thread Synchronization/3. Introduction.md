
---

# ðŸ”¹ Thread Synchronization in Java

## 1ï¸âƒ£ Problem: Incorrect Counter Value in Multithreading

### âŒ Code Without Synchronization

```java
public class Main {
    private static int counter = 0;

    public static void main(String[] args) throws InterruptedException {

        Thread thread1 = new Thread(() -> {
            for (int i = 0; i < 10000; i++) {
                counter++;
            }
        });

        Thread thread2 = new Thread(() -> {
            for (int i = 0; i < 10000; i++) {
                counter++;
            }
        });

        thread1.start();
        thread2.start();

        thread1.join();
        thread2.join();

        System.out.println("Counter value : " + counter);
    }
}
```

### ðŸ”» Output (varies every time)

```
Counter value : 13335
Counter value : 16583
Counter value : 14891
```

### â“ Expected Output

```
Counter value : 20000
```

---

## 2ï¸âƒ£ Why Is This Happening?

### ðŸ” Non-Atomic Operation

Even though `counter++` looks like a single operation, internally it consists of **three steps**:

1. **Read** the current value of `counter`
2. **Increment** the value
3. **Write** the updated value back

These steps are **not atomic**.

---

## 3ï¸âƒ£ Race Condition Explained

### ðŸ“Œ Definition

> **Race Condition** occurs when multiple threads access and modify a shared resource simultaneously, and the final result depends on the unpredictable timing of thread execution.

### ðŸ§  What Happens Internally?

| Thread-1          | Thread-2          |
| ----------------- | ----------------- |
| Reads counter = 0 |                   |
|                   | Reads counter = 0 |
| Increments to 1   | Increments to 1   |
| Writes 1          | Writes 1          |

ðŸ‘‰ Final value becomes **1 instead of 2**

---

### ðŸš¦ Real-Life Analogy: ATM Entry Register

* Imagine an ATM has a register showing "**People Entered = 0**".
* Two people enter the ATM at the same time.
* Both look at the register and see the value 0.
* Each person adds +1 in their mind.
* Both write back 1 on the register.
* The correct count should be 2, but the register shows 1.
* This happens because both updated the register without coordination.

This is exactly what happens in a **race condition**.

---

## 4ï¸âƒ£ Shared Resource

* `counter` is a **shared resource**
* Both threads are **modifying** it simultaneously
* No control over access â‡’ **inconsistency**

---

## 5ï¸âƒ£ Solution: Thread Synchronization

We must ensure:

> **Only one thread can modify the counter at a time**

This is called **Mutual Exclusion**.

---

## 6ï¸âƒ£ Fixed Code Using `synchronized`

### âœ… Code With Synchronization

```java
public class Main {
    private static int counter = 0;

    public static void main(String[] args) throws InterruptedException {

        Thread thread1 = new Thread(() -> {
            for (int i = 0; i < 10000; i++) {
                increment();
            }
        });

        Thread thread2 = new Thread(() -> {
            for (int i = 0; i < 10000; i++) {
                increment();
            }
        });

        thread1.start();
        thread2.start();

        thread1.join();
        thread2.join();

        System.out.println("Counter value : " + counter);
    }

    private synchronized static void increment() {
        counter++;
    }
}
```

### âœ… Output (Always Correct)

```
Counter value : 20000
```

---

## 7ï¸âƒ£ What Does `synchronized` Do?

* Allows **only one thread at a time** to execute the method
* Other threads **wait** until the lock is released
* Prevents simultaneous access to shared data

---

## 8ï¸âƒ£ Critical Section

### ðŸ“Œ Definition

> A **Critical Section** is a part of the code that accesses shared resources and must not be executed by more than one thread at a time.

### In Our Code:

```java
private synchronized static void increment() {
    counter++;
}
```

This method is the **critical section**.

---

### ðŸšª Real-Life Analogy: Bathroom with One Key ðŸš»

* One bathroom
* One key
* Only one person can enter at a time
* Others must wait outside

ðŸ‘‰ Bathroom = Critical Section
ðŸ‘‰ Key = Lock (`synchronized`)
ðŸ‘‰ People = Threads

---

## 9ï¸âƒ£ One-Line Summary

> **Race condition happens when multiple threads modify shared data simultaneously; synchronization protects the critical section by allowing only one thread at a time.**

---
