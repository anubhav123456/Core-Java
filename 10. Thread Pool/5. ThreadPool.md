
---

## ThreadPoolExecutor â€“ Core Concepts & Flow

### Key Parameters

* **Core Pool Size**

  * Minimum number of threads always kept alive.
  * These threads handle tasks immediately when available.

* **Work Queue (Queue Size)**

  * Holds tasks waiting for execution when core threads are busy.
  * Tasks in the queue are *not yet assigned* to any thread.

* **Maximum Pool Size**

  * Maximum number of threads that can be created.
  * Extra threads (beyond core threads) are created **only when the queue is full**.

* **Rejection Policy**

  * Defines what happens when:

    * All threads are busy **AND**
    * Queue is full **AND**
    * Max pool size is reached
  * Common behavior: **drop/reject the request** (can also customize).

---

## Task Execution Flow (Step-by-Step)

1. **Tasks arrive**

   * If core threads are free â†’ tasks are executed immediately.

2. **Core threads busy**

   * New tasks go into the **queue** (up to queue capacity).

3. **Queue is full**

   * Executor starts creating **additional threads** (beyond core size),
     up to **maximum pool size**.

4. **Max pool size reached**

   * If:

     * All threads are busy
     * Queue is full
   * ðŸ‘‰ **New incoming tasks are rejected/dropped** (or handled via custom policy).

---

## Example Scenario

* Core Pool Size = **2**
* Queue Size = **4**
* Max Pool Size = **5**
* Incoming Tasks = **10**

### Execution:

* Tasks 1â€“2 â†’ executed by **core threads**
* Tasks 3â€“6 â†’ placed in **queue**
* Tasks 7â€“9 â†’ new threads created (3 extra threads)
* Task 10 â†’ âŒ **rejected** (no threads free, queue full, max pool reached)

---

## Important Observations

* Threads are assigned **only when tasks are dequeued**, not when queued.
* If any thread becomes free:

  * It immediately picks a task from the queue.
* Extra threads (beyond core) may be terminated later if idle (based on config).

---

## Queue Size Trade-off (Very Important)

### Large Queue

âœ… Fewer task rejections
âŒ Slower execution (higher latency)
âŒ Tasks wait longer before execution

### Small Queue

âœ… Faster execution
âŒ More task rejections
âŒ System may drop requests frequently under load

---

## Core Insight (The Catch)

> **Queue size must be balanced**

* Too large â†’ system becomes slow
* Too small â†’ system starts rejecting requests aggressively

ðŸ‘‰ Proper tuning of **core threads**, **queue size**, and **max pool size** is critical for performance and stability.

---
